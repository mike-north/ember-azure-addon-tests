pr:
  - master
trigger:
  batch: true
  branches:
    include:
      - master
  paths:
    exclude:
      - README.md
      - CHANGELOG.md
      - CODE_OF_CONDUCT.md

variables:
  install_command: yarn install
  test_command: yarn test -r xunit

jobs:
  - job: linux
    displayName: 'Linux'
    pool:
      vmImage: 'vs2017-win2016'
    steps:
      - template: .ado/ci-template.yml
  - job: windows
    displayName: 'Windows'
    pool:
      vmImage: 'ubuntu-16.04'
    steps:
      - template: .ado/ci-template.yml
  - job: compatibility
    displayName: 'Compatibility Scenario:'
    pool:
      vmImage: 'ubuntu-16.04'
    dependsOn:
      - linux
    strategy:
      matrix:
        ember-release:
          displayName: 'ember-release'
          ember-try-scenario: 'ember-release'
        ember-beta:
          displayName: 'ember-beta'
          ember-try-scenario: 'ember-beta'
        ember-canary:
          displayName: 'ember-canary'
          ember-try-scenario: 'ember-canary'
      maxParallel: 5
    steps:
      - template: .ado/ci-template.yml
        parameters:
          testCommand: yarn ember try:one $(ember-try-scenario) -r xunit
          testDisplayName: 'Ember App Tests $(ember-try-scenario)'
  - job: floating_dependencies
    displayName: 'Linux (Floating Dependencies)'
    pool:
      vmImage: 'ubuntu-16.04'
    dependsOn:
      - linux
    steps:
      - template: .ado/ci-template.yml
        parameters:
          installCommand: yarn install --no-lockfile
